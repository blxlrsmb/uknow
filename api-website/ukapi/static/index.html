<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>UKnow InfoHub</title>
  <!-- <link rel="stylesheet" href="bower_components/bootstrap.css/css/bootstrap.css"> -->
  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/style.css">
  <script type="text/javascript" src="bower_components/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="bower_components/spin.js/spin.js"></script>
  <script type="text/javascript" src="bower_components/spin.js/jquery.spin.js"></script>
  <script type="text/javascript" src="bower_components/bootstrap.css/js/bootstrap.min.js"></script>
  <script type="text/javascript">
    document.API_URL = '';
  </script>
</head>

<body>
  <header>
    <div class="navbar navbar-fixed-top no-select" >
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" data-toggle="modal" href="#modalAbout">
            UKnow InfoHub
          </a>
          <ul class="nav" id="tabs">
<!--             <li class="divider-vertical"></li>
            <li class="itemCount"><a >Tab One</a></li>
 -->      </ul>
          <ul class="nav pull-left">
            <li><a onclick="$('#addtab').modal('show');" href="#"><i class="icon-plus icon-white"></i></a></li>
          </ul>
          <ul class="nav pull-right">
            <li><a onclick="dologout();" href="#"><i class="icon-off icon-white"></i></a></li>
          </ul>
          <form class="navbar-search pull-right" id="navSearch">
            <input type="search"  class="search-query" placeholder="Search">
          </form>
        </div>
      </div>
    </div>

  </header>
  <section class="mainContent">

    <section class="controls no-select">
      <div class="tControls">
        <div class="top">
          <button  class="btn" title="Mark all as read" alt="Mark all as read"><i class="icon-ok"></i></button>
        </div>
        <div class="middle">
          <button class="btn" ><i class="icon-arrow-up"></i></button>
          <button class="btn" ><i class="icon-arrow-down"></i></button>
        </div>
        <div class="bottom">
          <button class="btn" title="Refresh feeds" alt="Refresh feeds">
            <i class="icon-refresh"></i>
          </button>
        </div>
      </div>
    </section>

    <section class="summaries" id="summaries">

      <article class="well summary">
        <div class="row-fluid" >
          <div class="span6 pub-name">
            git.net9.org
          </div>
          <div class="span6 pub-date">
            <span class="label">Tag1</span>
            <span class="label label-important">Tag2</span>
          </div>
        </div>
        <h3 class="pub-title">UKnow InfoHub前端框架完成</h3>
      </article>

      <article class="well summary">
        <div class="row-fluid" >
          <div class="span6 pub-name">
            git.net9.org
          </div>
          <div class="span6 pub-date">
            <span class="label">Tag1</span>
            <span class="label label-important">Tag2</span>
          </div>
        </div>
        <h3 class="pub-title">UKnow InfoHub前端框架完成</h3>
      </article>

    </section>


    <section class="entries" id="entries">

      <article class="well entry active" id="article">
        <div class="row-fluid">
          <div class="span8" id="article-source">git.net9.org</div>
          <div class="span4 actions">
            <a><i class="icon-share"></i></a>
          </div>
          <h2 id="article-title">UKnow InfoHub前端框架完成</h2>
          <span class="author" id="article-author">Author</span>
          <hr />
          <div id="article-content"></div>
        </div>
      </article>

    </section>

  </section>

  <!-- Modal -->
  <div id="modalAbout" class="modal hide fade" tabindex="-1" role="dialog">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3>About UKnow InfoHub</h3>
    </div>
    <div class="modal-body">
      <p>blah blah blah</p>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
  </div>

  <div id="loading" class="modal hide fade" tabindex="-1" role="dialog">
    <div class="modal-body" style="height: 80px">
      <div id="loading-spin" style="margin: 30px 50%"></div>
    </div>
  </div>

  <div id="register" class="modal hide fade" tabindex="-1" role="dialog" z-index="1">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3>Register</h3>
    </div>
    <div class="modal-body">
      <form class="form-horizontal" action="#" id="register-form">
        <div class="control-group">
          <label class="control-label" for="register-email">Email</label>
          <div class="controls">
            <input type="text" id="register-email" placeholder="Email">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="register-password">Password</label>
          <div class="controls">
            <input type="password" id="register-password" placeholder="Password">
          </div>
        </div>
        <div class="control-group">
          <div class="controls">
            <button type="submit" class="btn">Sign up</button>
          </div>
        </div>
      </form>
      <script type="text/javascript">
      $('#register-form').on('submit', function(e){
        e.preventDefault();
        var data = JSON.stringify({
          'username': $('#register-email').val(),
          'password': $('#register-password').val()
        });
        $.ajax({
          url: document.API_URL+'/register',
          type: 'POST',
          dataType: 'json',
          contentType: 'json',
          data: data,
          crossDomain: true,
          success: function(ret){
            if(ret['success'] == 1){
              alert('Register ok.');
              $('#register').modal('hide');
              $('#login').modal('show');
            }
            if(ret['error'] !== undefined)
              alert(ret['error']);
          }
        });
      });
      </script>
    </div>
  </div>

  <div id="login" class="modal hide fade" tabindex="-1" role="dialog" z-index="10">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3>Login</h3>
    </div>
    <div class="modal-body">
      <form class="form-horizontal" action="#" id="login-form">
        <div class="control-group">
          <label class="control-label" for="login-email">Email</label>
          <div class="controls">
            <input type="text" id="login-email" placeholder="Email">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="login-password">Password</label>
          <div class="controls">
            <input type="password" id="login-password" placeholder="Password">
          </div>
        </div>
        <div class="control-group">
          <div class="controls">
            <button class="btn btn-info" id="login-register">Register</button>
            <button type="submit" class="btn">Go!</button>
          </div>
        </div>
      </form>
      <script type="text/javascript">
      $('#login-register').click(function(e){
        e.preventDefault();
        $('#login').modal('hide');
        $('#register').modal('show');
      })
      $('#login-form').on('submit', function(e){
        e.preventDefault();
        var data = JSON.stringify({
          'username': $('#login-email').val(),
          'password': $('#login-password').val()
        });
        $.ajax({
          url: document.API_URL+'/login',
          type: 'POST',
          dataType: 'json',
          contentType: 'json',
          data: data,
          crossDomain: true,
          success: function(ret){
            if(ret['success'] == 1){
              alert('Login ok.');
              $('#login').modal('hide');
              refreshTab();
            }
            if(ret['error'] !== undefined)
              alert(ret['error']);
          }
        });
      });
      </script>
    </div>
  </div>

  <div id="addtab" class="modal hide fade" tabindex="-1" role="dialog" z-index="10">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3>Add Tab</h3>
    </div>
    <div class="modal-body">
      <form class="form-horizontal" action="#" id="addtab-form">
        <div class="control-group">
          <label class="control-label" for="addtab-name">Name</label>
          <div class="controls">
            <input type="text" id="addtab-name" placeholder="Aha">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="addtab-priority">Priority</label>
          <div class="controls">
            <input type="text" id="addtab-priority" placeholder="10">
          </div>
        </div>
        <div class="control-group">
          <div class="controls">
            <button type="submit" class="btn">Add!</button>
          </div>
        </div>
      </form>
      <script type="text/javascript">
      $('#addtab-form').on('submit', function(e){
        e.preventDefault();
        var data = JSON.stringify({
          'name': $('#addtab-name').val(),
          'priority': $('#addtab-priority').val()
        });
        $.ajax({
          url: document.API_URL+'/add_tab',
          type: 'POST',
          dataType: 'json',
          contentType: 'json',
          data: data,
          crossDomain: true,
          success: function(ret){
            if(ret['success'] == 1){
              alert('Add tab ok.');
              $('#addtab').modal('hide');
              refreshTab();
            }
            if(ret['error'] !== undefined)
              alert(ret['error']);
          }
        });
      });
      </script>
    </div>
  </div>

    <script type="text/javascript">
      $('#loading-spin').spin();
      appendNewSummary = function(source, tags, title){
        var $pubname = $('<div>').addClass('span6 pub-name').text(source);
        var $pubdate = $('<div>').addClass('span6 pub-date');
        $.map(tags, function(t, i){
          $pubdate.append(' ').append($('<span>').addClass('label').text(t));
        });
        var $article = $('<article>').addClass('well summary');
        $article.append($('<div>').addClass('row-fluid').append($pubname).append($pubdate));
        $article.append($('<h3>').addClass('pub-title').text(title));
        $('#summaries').append($article);
        return $article;
      };
      setArticle = function(source, title, author, content){
        $('#article-source').text(source);
        $('#article-title').text(title);
        $('#article-author').text(author);
        $('#article-content').html(content);
      };
      refreshTab = function(){
        $('#loading').modal('show');
        $.getJSON(document.API_URL+'/get_all_tabs', '', function(ret){
          if(ret['tabs'] === undefined){
            alert('Error refreshing tabs');
          } else {
            $tabs = $('#tabs').html('');
            ret['tabs'].sort(function(a,b){
              return a['priority'] > b['priority'];
            });
            $.each(ret['tabs'], function(i,t){
              $tabs.append($('<li>').addClass('divider-vertical'));
              var $a = $('<a>').text(t['name']).attr('href','#');
              $tabs.append($('<li>').addClass('itemCount').append($a));
            });
            $tabs.append($('<li>').addClass('divider-vertical'));
            $('#loading').modal('hide');
          }
        });
      };
      dologout = function(){
        $('#loading').modal('show');
        $.getJSON(document.API_URL+'/logout', '', function(ret){
          $('#loading').modal('hide');
          $('#login').modal('show');
          showblackface();
        })
      };
      showblackface = function(){
        $('body').html('');
        $('body').attr('style','background-color: #000000;');
        var $div = $('<div>').attr('style', 'margin: 150px auto');
        $div.append($('<img>').attr('src', 'img/logo.svg').attr('style','padding-left:40%'));
        $('body').append($div);
        var sound = new Audio('img/haha.mp3');
        sound.play();
      };
      $(document).ready(function(){
        appendNewSummary('网易头条', ['Tag1', 'Tag2'], '清华大学期末考试取消');
        setArticle('网易头条', '清华大学期末考试取消', 'BlahGeek', 'blah blah blah')
      });
      setTimeout(function(){$('#login').modal('show')}, 0);
    </script>


</body>
</html>
