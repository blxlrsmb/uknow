<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>UKnow InfoHub</title>
  <!-- <link rel="stylesheet" href="bower_components/bootstrap.css/css/bootstrap.css"> -->
  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="bower_components/chosen_v1/chosen.min.css">
  <script type="text/javascript" src="bower_components/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="bower_components/chosen_v1/chosen.jquery.min.js"></script>
  <script type="text/javascript" src="bower_components/spin.js/spin.js"></script>
  <script type="text/javascript" src="bower_components/spin.js/jquery.spin.js"></script>
  <script type="text/javascript" src="bower_components/bootstrap.css/js/bootstrap.min.js"></script>
  <script type="text/javascript">
    document.API_URL = '';
  </script>
  <script type="text/javascript" src="js/myforms.js"></script>
</head>

<body>
  <header>
    <div class="navbar navbar-fixed-top no-select" >
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" data-toggle="modal" href="#modalAbout">
            UKnow InfoHub
          </a>
          <ul class="nav" id="tabs">
<!--             <li class="divider-vertical"></li>
            <li class="itemCount"><a >Tab One</a></li>
 -->      </ul>
          <ul class="nav pull-left">
            <li><a onclick="showAddTabForm();" href="#"><i class="icon-plus icon-white"></i></a></li>
          </ul>
          <ul class="nav pull-right">
            <li><a onclick="doLogout();" href="#"><i class="icon-off icon-white"></i></a></li>
          </ul>
          <form class="navbar-search pull-right" id="navSearch">
            <input type="search"  class="search-query" placeholder="Search">
          </form>
        </div>
      </div>
    </div>

  </header>
  <section class="mainContent">

    <section class="controls no-select">
      <div class="tControls">
        <div class="top">
          <button class="btn" title="Delete this tab" id="delete-tab"><i class="icon-trash"></i></button>
          <button class="btn" title="Edit this tab" id="edit-tab"><i class="icon-edit"></i></button>
        </div>
        <div class="middle">
          <button class="btn" ><i class="icon-arrow-up"></i></button>
          <button class="btn" ><i class="icon-arrow-down"></i></button>
        </div>
        <div class="bottom">
          <button class="btn" title="Refresh feeds" alt="Refresh feeds">
            <i class="icon-refresh"></i>
          </button>
        </div>
      </div>
    </section>

    <section class="summaries" id="summaries">

      <article class="well summary">
        <div class="row-fluid" >
          <div class="span6 pub-name">
            git.net9.org
          </div>
          <div class="span6 pub-date">
            <span class="label">Tag1</span>
            <span class="label label-important">Tag2</span>
          </div>
        </div>
        <h3 class="pub-title">UKnow InfoHub前端框架完成</h3>
      </article>

      <article class="well summary">
        <div class="row-fluid" >
          <div class="span6 pub-name">
            git.net9.org
          </div>
          <div class="span6 pub-date">
            <span class="label">Tag1</span>
            <span class="label label-important">Tag2</span>
          </div>
        </div>
        <h3 class="pub-title">UKnow InfoHub前端框架完成</h3>
      </article>

    </section>


    <section class="entries" id="entries">

      <article class="well entry active" id="article">
        <div class="row-fluid">
          <div class="span8" id="article-source">git.net9.org</div>
          <div class="span4 actions">
            <a><i class="icon-share"></i></a>
          </div>
          <h2 id="article-title">UKnow InfoHub前端框架完成</h2>
          <span class="author" id="article-author">Author</span>
          <hr />
          <div id="article-content"></div>
        </div>
      </article>

    </section>

  </section>

  <!-- Modal -->
  <div id="modalAbout" class="modal hide fade" tabindex="-1" role="dialog">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3>About UKnow InfoHub</h3>
    </div>
    <div class="modal-body">
      <p>blah blah blah</p>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
  </div>

  <div id="loading" class="modal hide fade" tabindex="-1" role="dialog">
    <div class="modal-body" style="height: 80px">
      <div id="loading-spin" style="margin: 30px 50%"></div>
    </div>
  </div>

  <div id="form-modal" class="modal hide fade" tabindex="-1" role="dialog" z-index="1">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3></h3>
    </div>
    <div class="modal-body"></div>
  </div>

    <script type="text/javascript">
      $('#loading-spin').spin();
      appendNewSummary = function(source, tags, title){
        var $pubname = $('<div>').addClass('span6 pub-name').text(source);
        var $pubdate = $('<div>').addClass('span6 pub-date');
        $.map(tags, function(t, i){
          $pubdate.append(' ').append($('<span>').addClass('label').text(t));
        });
        var $article = $('<article>').addClass('well summary');
        $article.append($('<div>').addClass('row-fluid').append($pubname).append($pubdate));
        $article.append($('<h3>').addClass('pub-title').text(title));
        $('#summaries').append($article);
        return $article;
      };
      setArticle = function(source, title, author, content){
        $('#article-source').text(source);
        $('#article-title').text(title);
        $('#article-author').text(author);
        $('#article-content').html(content);
      };
      refreshTab = function(){
        $('#loading').modal('show');
        $.getJSON(document.API_URL+'/get_all_tabs', '', function(ret){
          if(ret['tabs'] === undefined){
            alert('Error refreshing tabs');
          } else {
            $tabs = $('#tabs').html('');
            ret['tabs'].sort(function(a,b){
              return parseInt(a['priority']) > parseInt(b['priority']);
            });
            $.each(ret['tabs'], function(i,t){
              $tabs.append($('<li>').addClass('divider-vertical'));
              var $a = $('<a>').text(t['name']).attr('href','#');
              $a.click(function(e){
                e.preventDefault();
                focusTab($(this).parent());
              });
              $tabs.append($('<li>').addClass('itemCount').append($a));
            });
            $tabs.append($('<li>').addClass('divider-vertical'));
            focusTab(0);
            $('#loading').modal('hide');
          }
        });
      };
      getNowTab = function(){
        return $('.itemCount.active').text();
      };
      focusTab = function(n){
        $.each($('.itemCount'), function(i, tab){
          var $tab = $(tab);
          if($tab.is(n) || (typeof(n)=="number"&&i==n) || (typeof(n)=="string"&&n==$tab.text()))
            $tab.addClass('active');
          else
            $tab.removeClass('active');
        });
      };
      $('#delete-tab').click(function(e){
        e.preventDefault();
        showDeleteTabForm(getNowTab());
      });
      $('#edit-tab').click(function(e){
        e.preventDefault();
        showEditTabForm(getNowTab());
      });

      doLogout = function(){
        $('#loading').modal('show');
        $.getJSON(document.API_URL + '/logout', '', function(ret){
          $('#loading').modal('hide');
          $('#login').modal('show');
          showBlackface();
        })
      };

      showBlackface = function(){
        $('body').html('');
        $('body').attr('style','background-color: #000000;');
        var $div = $('<div>').attr('style', 'margin: 150px auto');
        $div.append($('<img>').attr('src', 'img/logo.svg').attr('style','padding-left:40%'));
        $('body').append($div);
        var sound = new Audio('img/haha.mp3');
        sound.play();
      };
      $(document).ready(function(){
        appendNewSummary('网易头条', ['Tag1', 'Tag2'], '清华大学期末考试取消');
        setArticle('网易头条', '清华大学期末考试取消', 'BlahGeek', 'blah blah blah')
      });

			checkLogin = function() {
				$.ajax({
					url: document.API_URL + '/test_login',
					type: 'GET',
					crossDomain: true,
					error: function(ret) {
						// ret['status'] == 401
						window.location.replace('/static/login.html');
					}
				});
			};
      setTimeout(checkLogin, 0);
    </script>


</body>
</html>
